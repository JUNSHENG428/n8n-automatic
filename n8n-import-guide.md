# n8n工作流导入指南

## 错误："propertyValues[itemName] is not iterable"

这个错误通常是由于工作流JSON格式与n8n版本不兼容导致的。

### 常见原因：

1. **节点版本号过高**：使用了n8n当前版本不支持的节点版本
2. **Set节点参数格式错误**：新版本格式与旧版本不兼容
3. **错误的连接配置**：节点连接形成循环或引用不存在的节点
4. **不支持的字段格式**：某些字段使用了错误的数据结构

### 解决方案：

我为您创建了3个不同版本的天气预报工作流：

## 1. 简化版工作流（推荐先试这个）
文件：`simple-weather-workflow.json`

特点：
- 只包含5个基本节点
- 使用兼容性最好的节点版本
- 手动触发，方便测试
- 简单直接的数据流

使用步骤：
1. 导入工作流
2. 在"设置参数"节点中配置：
   - city: 城市名称（如Beijing）
   - apiKey: WeatherAPI密钥
   - recipientEmail: 接收邮件地址
3. 在"发送邮件"节点配置SMTP信息

## 2. 修复版完整工作流
文件：`fixed-weather-workflow.json`

特点：
- 包含错误处理和重试机制
- 使用cron定时触发
- 支持环境变量配置
- 12个节点的完整流程

## 3. 原始优化版工作流
文件：`optimized-weather-workflow.json`

注意：这个版本可能不兼容某些n8n版本

## 配置要求

### 1. WeatherAPI配置
- 注册账号：https://www.weatherapi.com
- 获取免费API密钥（1000次/天）
- 在工作流中配置密钥

### 2. 邮件服务配置
在n8n中配置SMTP凭据：
- SMTP服务器地址
- 端口（通常587或465）
- 用户名和密码
- 发件人邮箱

### 3. 环境变量（可选）
如果使用环境变量，在n8n中设置：
- WEATHER_API_KEY：天气API密钥
- WEATHER_CITY：默认城市
- RECIPIENT_EMAIL：收件人邮箱
- SMTP_FROM_EMAIL：发件人邮箱

## 导入步骤

1. 打开n8n工作流编辑器
2. 点击菜单 → Import from File
3. 选择JSON文件
4. 如果出错，尝试其他版本的文件

## 故障排除

### 如果仍然无法导入：

1. **检查n8n版本**
   ```bash
   n8n --version
   ```
   建议使用最新稳定版

2. **手动创建工作流**
   - 参考JSON文件的节点配置
   - 逐个添加节点
   - 手动连接节点

3. **简化节点参数**
   - 移除高级选项
   - 使用基本配置
   - 逐步添加功能

4. **检查节点类型**
   确保使用的节点类型在您的n8n实例中可用：
   - httpRequest (v3)
   - emailSend (v2)
   - code (v1)
   - set (v1或v2)

## 测试建议

1. 先使用手动触发测试
2. 确认API调用成功
3. 检查邮件格式正确
4. 再设置定时触发

如有问题，可以：
- 查看n8n日志
- 使用简化版本
- 逐步添加功能 